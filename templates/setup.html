{% extends "base.html" %}

{% block title %}Setup - Dispute #{{ dispute_id }} - {{ username }}{% endblock %}

{% block content %}
<div class="player-info" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 30px;">
    <h2 style="color: white; margin: 0 0 10px 0;">Welcome, {{ username }}!</h2>
    <p><strong>Role:</strong> Player {{ '1 (Claimant)' if is_player1 else '2 (Respondent)' }}</p>
    <p><strong>Dispute ID:</strong> {{ dispute_id }}</p>
    <p><strong>Status:</strong> Setup Phase</p>
</div>

{% if not player_setup_complete %}
    <div class="info-box">
        <h3>Setup Your Position</h3>
        <p>Please enter your private values and initial position. These values will guide the negotiation process.</p>
    </div>

    <form method="POST" action="/dispute/{{ dispute_id }}/{{ username }}/setup">
        {% if is_player1 %}
            <div class="form-group">
                <label for="private_value">Your Minimum Acceptable Amount (Private):</label>
                <input type="number" id="private_value" name="private_value" step="0.01" required placeholder="e.g., 1050">
                <p class="help-text">This is the minimum you will accept. It remains private to you.</p>
            </div>
            
            <div class="form-group">
                <label for="initial_position">Your Initial Claim:</label>
                <input type="number" id="initial_position" name="initial_position" step="0.01" required placeholder="e.g., 1500">
                <p class="help-text">This is what you're claiming. It should be higher than your minimum.</p>
            </div>
        {% else %}
            <div class="form-group">
                <label for="private_value">Your Maximum Offer (Private):</label>
                <input type="number" id="private_value" name="private_value" step="0.01" required placeholder="e.g., 1175">
                <p class="help-text">This is the maximum you can offer. It remains private to you.</p>
            </div>
            
            <div class="form-group">
                <label for="initial_position">Your Initial Counteroffer:</label>
                <input type="number" id="initial_position" name="initial_position" step="0.01" required placeholder="e.g., 800">
                <p class="help-text">This is what you're offering. It should be lower than your maximum.</p>
            </div>
        {% endif %}
        
        <button type="submit">Submit Setup</button>
    </form>
{% else %}
    <div class="info-box success">
        <h3>‚úì Your Setup is Complete</h3>
        <p><strong>Your private value:</strong> ${{ "%.2f"|format(dispute.v1 if is_player1 else dispute.v2) }}</p>
        <p><strong>Your initial position:</strong> ${{ "%.2f"|format(dispute.c if is_player1 else dispute.s) }}</p>
    </div>
    
    {% if not other_setup_complete %}
        <div class="waiting-box" style="background: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 12px; text-align: center; margin: 30px 0;">
            <h3 style="color: #856404; margin-bottom: 10px;">‚è≥ Waiting for Other Player</h3>
            <div style="border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto;"></div>
            <p>Waiting for {{ dispute.userB if is_player1 else dispute.userA }} to complete their setup.</p>
            <button onclick="location.reload()" class="secondary" style="margin-top: 20px; width: auto; padding: 10px 24px;">Refresh Page</button>
        </div>
    {% else %}
        <div class="info-box success">
            <h3>üéâ Both Players Ready!</h3>
            <p>The negotiation can now begin.</p>
            <button onclick="location.reload()" style="margin-top: 15px;">Start Negotiation</button>
        </div>
    {% endif %}
{% endif %}

<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
{% endblock %}
